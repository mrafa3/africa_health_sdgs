---
title: "R Notebook"
output: html_notebook
---

# Setup

```{r setup, include=TRUE, message=FALSE, warning=FALSE}
#library(cowplot)
library(tidyverse)
library(sf)
#library(rnaturalearth)
library(maps)
#library(viridis)
library(patchwork)
```

Read in the cluster analysis results from Part One.

```{r read_kmeans_viz_data, include=TRUE, echo=FALSE, message=FALSE}
kmeans_viz_data <- read_csv('.//data/kmeans_viz_data.csv')
```

Get the country polygons from the `sf::` package.

```{r world_polygons, include=TRUE}
world1 <- sf::st_as_sf(map('world', plot = FALSE, fill = TRUE))
```

Plot these polygons using `ggplot()`.

```{r test_plot_africa, include=TRUE}
ggplot() + 
  geom_sf(data = world1) + 
  coord_sf(xlim = c(-30, 60),
            ylim = c(39, -37))
```
Create custom map themes.

```{r map_themes, include=TRUE, echo=FALSE}
map.theme <- theme(text = element_text(family = "Arial", color = "black"), 
                   panel.background = element_rect(fill = "white"),
                   plot.background = element_rect(fill = "white"),
                   #panel.grid = element_blank(),
                   #panel.border = element_blank(),
                   plot.title = element_text(size = 25, hjust = 0),
                   plot.subtitle = element_text(size = 25),
                   plot.caption = element_text(size = 20), 
                   axis.text = element_blank(),
                   axis.title = element_blank(),
                   axis.ticks = element_blank(),
                   legend.position = "inside", 
                   legend.key.size = unit(.7, "cm"),
                   legend.direction = "horizontal",
                   legend.background = element_rect(fill="white"))

map.theme.small <- theme(text = element_text(family = "Arial", color = "black"), 
                   panel.background = element_rect(fill = "white"),
                   plot.background = element_rect(fill = "white"),
                   panel.grid = element_blank(),
                   plot.title = element_text(size = 8, face = 'bold', hjust = 0.5),
                   plot.subtitle = element_text(size = 8),
                   axis.text = element_blank(),
                   axis.title = element_blank(),
                   axis.ticks = element_blank(),
                   legend.position = "none", 
                   legend.background = element_rect(fill="white"),
                   legend.title = element_blank())
```

# Mapping 

Recode some country names to make `sf::` and the cluster results compatible.

```{r recode_cnty_names, include=TRUE, echo=FALSE}
map.world <- map_data("world") %>% 
  mutate(region = recode(region, 
                         "Central African Republic" = "Central AfR",
                         'Democratic Republic of the Congo' = 'Congo, Democratic Republic of',
                         'Republic of Congo' = 'Congo, Republic of',
                         'Equatorial Guinea' = 'Equa Guinea',
                         'Guinea-Bissau' = 'GuineaBiss',
                         'Ivory Coast' = "Cote d'Ivoire",
                         'Sierra Leone' = 'SierraLeo', 
                         'South Sudan' = 'Sudan South'))
```

# Cluster maps

```{r }
joined.world.map <- left_join(x=map.world,
                             y=kmeans_viz_data,
                             by=c('region' = 'country'))
```

```{r l_map_clust, include=TRUE, fig.height=6.2, fig.width=10, fig.align='center'}
(l_map_clust <- joined.world.map %>% 
  filter(africa == '1') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = clust_name), color="gray90") +
  geom_polygon(data=. %>% filter(region == 'Western Sahara'),
               aes(x = long, y = lat, group = group), fill = "gray90", color="gray90") +
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = '') + 
  scale_fill_jco() + 
  map.theme + 
  guides(fill=guide_legend(nrow=2, byrow=TRUE)) + 
  theme(legend.position.inside = c(.2, .3)))
```

```{r fig.width=2, fig.height=2}
(s_map_1 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = clust_name), color="gray90") +
  scale_fill_jco() + 
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_2 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = clust_name), color="gray90") +
  scale_fill_jco() + 
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```



```{r fig.width=2, fig.height=2}
(s_map_3 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = clust_name), color="gray90") +
  scale_fill_jco() + 
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_4 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = clust_name), color="gray90") +
  scale_fill_jco() + 
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_5 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = clust_name), color="gray90") +
  scale_fill_jco() + 
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```

```{r fig.width=3, fig.height=10}
(s_map_plot_grid <- s_map_1 / s_map_2 / s_map_3 / s_map_4 / s_map_5)
```

```{r combined_cluster_map, include=TRUE, fig.height=6.2, fig.width=10, fig.align='center'}
(l_map_clust + s_map_plot_grid + plot_layout(widths = c(8, 1, 1)))
```


```{r}
ggsave("map_cluster.png", plot = l_map_clust, height = 10, width = 10, family="Arial", device='png')
```

```{r}
ggsave("map_cluster_islands.png", plot = s_map_plot_grid, height = 10, width = 2, family="Arial", device='png')
```

# SDG maps 

## Achievement 

```{r}
rm(joined.world.map)
joined.world.map <- left_join(x=map.world,
                             y=df_maternal_2,
                             by=c('region' = 'country'))
```


```{r}
map.world.2 <- joined.world.map %>% 
  mutate(region = recode(region, 
                         "Central African Republic" = "Central AfR",
                         'Democratic Republic of the Congo' = 'Congo, Democratic Republic of',
                         'Republic of Congo' = 'Congo, Republic of',
                         'Equatorial Guinea' = 'Equa Guinea',
                         'Guinea-Bissau' = 'GuineaBiss',
                         'Ivory Coast' = "Cote d'Ivoire",
                         'Sierra Leone' = 'SierraLeo', 
                         'South Sudan' = 'Sudan South'))
```


```{r}
binary_cols <- c('Not achieved' = 'firebrick1', 'Achieved' = 'forestgreen')
binary_alpha <- c('Not achieved' = 1, 'Achieved' = 1)
```

```{r fig.height=6.2}
(l_map <- joined.world.map %>% 
  filter(africa == 1) %>% 
  mutate(achieve = ifelse(`2030` <= 70, 'Achieved', 'Not achieved')) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = achieve, alpha = achieve), color="gray90") + 
  geom_polygon(data=joined.world.map %>% filter(region == 'Western Sahara'),
               aes(x = long, y = lat, group = group), 
               linetype='longdash', fill="gray90") + 
  #ggtitle('2018') + 
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = 'Maternal mortality rate') + 
  #scale_fill_gradient2(midpoint = 25, )
  scale_fill_manual(values = binary_cols) + 
  scale_alpha_manual(values = binary_alpha) + 
  map.theme + 
  #guides(fill = title.position = "top") + 
  guides(fill = guide_legend(title.position = "top"),
         alpha = 'none') + 
  theme(legend.position = c(.04, .3)))
    #legend.title = element_text(size=9, family = "Arial", color = "black"),
        #legend.text = element_text(size=10, family = "Arial", color = "black")))
```



```{r fig.width=2, fig.height=2}
(s_map_1 <- joined.world.map %>% 
  #filter(region == 'Cape Verde') %>% 
  filter(africa == 1) %>% 
  mutate(achieve = ifelse(`2030` <= 70, 'Achieved', 'Not achieved')) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = achieve), color="gray90") +
  scale_fill_manual(values = binary_cols) + 
  scale_alpha_manual(values = binary_alpha) + 
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_2 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  mutate(achieve = ifelse(`2030` <= 70, 'Achieved', 'Not achieved')) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = achieve), color="gray90") +
  scale_fill_manual(values = binary_cols) + 
  scale_alpha_manual(values = binary_alpha) + 
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```



```{r fig.width=2, fig.height=2}
(s_map_3 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  mutate(achieve = ifelse(`2030` <= 70, 'Achieved', 'Not achieved')) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = achieve), color="gray90") +
  scale_fill_manual(values = binary_cols) + 
  scale_alpha_manual(values = binary_alpha) + 
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```



```{r fig.width=2, fig.height=2}
(s_map_4 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  mutate(achieve = ifelse(`2030` <= 70, 'Achieved', 'Not achieved')) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = achieve), color="gray90") +
  scale_fill_manual(values = binary_cols) + 
  scale_alpha_manual(values = binary_alpha) + 
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_5 <- joined.world.map %>% 
  filter(africa == 1) %>% 
  mutate(achieve = ifelse(`2030` <= 70, 'Achieved', 'Not achieved')) %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = achieve), color="gray90") +
  scale_fill_manual(values = binary_cols) + 
  scale_alpha_manual(values = binary_alpha) + 
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```

```{r fig.width=3, fig.height=10}
s_map_plot_grid <- plot_grid(s_map_1, s_map_2, s_map_3, s_map_4, s_map_5, 
                             ncol = 1,
                             align = c('h', 'v'))

s_map_plot_grid
```


# Continuous 

```{r}
rm(joined.world.map)
joined.world.map <- left_join(x=map.world,
                             y=df_maternal_2,
                             by=c('region' = 'country'))
```


```{r}
map.world.2 <- joined.world.map %>% 
  mutate(region = recode(region, 
                         "Central African Republic" = "Central AfR",
                         'Democratic Republic of the Congo' = 'Congo, Democratic Republic of',
                         'Republic of Congo' = 'Congo, Republic of',
                         'Equatorial Guinea' = 'Equa Guinea',
                         'Guinea-Bissau' = 'GuineaBiss',
                         'Ivory Coast' = "Cote d'Ivoire",
                         'Sierra Leone' = 'SierraLeo', 
                         'South Sudan' = 'Sudan South'))
```

```{r}
joined.world.map %>% 
  filter(region == 'Western Sahara')
```


```{r fig.height=6.2}
(l_map <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="gray90") + 
  geom_polygon(data=joined.world.map %>% filter(region == 'Western Sahara'),
               aes(x = long, y = lat, group = group, fill = `2030`), linetype='longdash', color="gray90") + 
  #ggtitle('2018') + 
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = 'Maternal mortality rate') + 
  #scale_fill_gradient2(midpoint = 25, )
  scale_fill_viridis_c(na.value = 'lightgray') + 
  map.theme + 
  guides(fill = guide_colorbar(title.position = "top")) + 
  theme(legend.position = c(.08, .3)))
    #legend.title = element_text(size=9, family = "Arial", color = "black"),
        #legend.text = element_text(size=10, family = "Arial", color = "black")))
```



```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_maternal_2030.png", plot = l_map, height = 10, width = 10, family="Arial", device='png')
```



```{r fig.width=2, fig.height=2}
(s_map_1 <- joined.world.map %>% 
  #filter(region == 'Cape Verde') %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  #summary()
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_2 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```



```{r fig.width=2, fig.height=2}
(s_map_3 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```



```{r fig.width=2, fig.height=2}
(s_map_4 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_5 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```

```{r fig.width=3, fig.height=10}
s_map_plot_grid <- plot_grid(s_map_1, s_map_2, s_map_3, s_map_4, s_map_5, 
                             ncol = 1,
                             align = c('h', 'v'))

s_map_plot_grid
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_maternal_islands.png", plot = s_map_plot_grid, height = 10, width = 2, family="Arial", device='png')
```

# Neonatal mortality map 

```{r}
rm(joined.world.map)
joined.world.map <- left_join(x=map.world,
                             y=df_neonatal_2,
                             by=c('region' = 'country'))
```

```{r fig.height=6.2}
(map_neonatal_afr <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="gray90") +
  #ggtitle('2018') + 
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = 'Neonatal mortality rate') + 
  scale_fill_viridis_c(na.value = 'lightgray') + 
  map.theme + 
  guides(fill = guide_colorbar(title.position = "top")) + 
  theme(legend.position = c(.08, .3)))
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_neonatal_2030.png", plot = map_neonatal_afr, height = 10, width = 10, family="Arial", device='png')
```

## Neonatal map: islands 

```{r fig.width=2, fig.height=2}
(s_map_neonatal_1 <- joined.world.map %>% 
  #filter(region == 'Cape Verde') %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  #summary()
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_neonatal_2 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_neonatal_3 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_neonatal_4 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_neonatal_5 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```


```{r fig.width=3, fig.height=10}
s_map_neonatal_plot_grid <- plot_grid(s_map_neonatal_1, s_map_neonatal_2, s_map_neonatal_3, 
                                      s_map_neonatal_4, s_map_neonatal_5, 
                             ncol = 1,
                             align = c('h', 'v'))

s_map_neonatal_plot_grid
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_neonatal_islands.png", plot = s_map_neonatal_plot_grid, height = 10, width = 2, family="Arial", device='png')
```

# Under-5 mortality map 

```{r}
rm(joined.world.map)
joined.world.map <- left_join(x=map.world,
                             y=df_u5mr_2,
                             by=c('region' = 'country'))
```

```{r fig.height=6.2}
(map_u5mr_afr <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="gray90") +
  #ggtitle('2018') + 
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = 'Under-5 mortality rate') + 
  scale_fill_viridis_c(na.value = 'lightgray') + 
  map.theme + 
  guides(fill = guide_colorbar(title.position = "top")) + 
  theme(legend.position = c(.08, .3)))
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_u5mr_2030.png", plot = map_u5mr_afr, height = 10, width = 10, family="Arial", device='png')
```

## Neonatal map: islands 

```{r fig.width=2, fig.height=2}
(s_map_u5mr_1 <- joined.world.map %>% 
  #filter(region == 'Cape Verde') %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  #summary()
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_u5mr_2 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_u5mr_3 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_u5mr_4 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_u5mr_5 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```


```{r fig.width=3, fig.height=10}
s_map_u5mr_plot_grid <- plot_grid(s_map_u5mr_1, s_map_u5mr_2, s_map_u5mr_3, 
                                      s_map_u5mr_4, s_map_u5mr_5, 
                             ncol = 1,
                             align = c('h', 'v'))

s_map_u5mr_plot_grid
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_u5mr_islands.png", plot = s_map_u5mr_plot_grid, height = 10, width = 2, family="Arial", device='png')
```

# Map of NCDs 

```{r}
(df_ncd_traff <- df_master_2 %>% 
  filter(unit %in% c('NonCommun', 'TrafficAcc')) %>% 
  mutate(africa = 1))
```


```{r}
rm(joined.world.map)
joined.world.map <- left_join(x=map.world,
                             y=df_ncd_traff %>% filter(unit == 'NonCommun'),
                             by=c('region' = 'country'))
```


```{r fig.height=6.2}
(map_ncds_afr <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="gray90") +
  #ggtitle('2018') + 
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = 'NCD mortality rate (per thous)') + 
  scale_fill_viridis_c(na.value = 'lightgray') + 
  map.theme + 
  guides(fill = guide_colorbar(title.position = "top")) + 
  theme(legend.position = c(.08, .3),
        legend.title = element_text(size=10)))
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_ncds_2030.png", plot = map_ncds_afr, height = 10, width = 10, family="Arial", device='png')
```

## Neonatal map: islands 

```{r fig.width=2, fig.height=2}
(s_map_ncds_1 <- joined.world.map %>% 
  #filter(region == 'Cape Verde') %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  #summary()
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_ncds_2 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_ncds_3 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_ncds_4 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_ncds_5 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```


```{r fig.width=3, fig.height=10}
s_map_ncds_plot_grid <- plot_grid(s_map_ncds_1, s_map_ncds_2, s_map_ncds_3, 
                                      s_map_ncds_4, s_map_ncds_5, 
                             ncol = 1,
                             align = c('h', 'v'))

s_map_ncds_plot_grid
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_ncds_islands.png", plot = s_map_ncds_plot_grid, height = 10, width = 2, family="Arial", device='png')
```


# Map of Traffic accidents 


```{r}
rm(joined.world.map)
joined.world.map <- left_join(x=map.world,
                             y=df_ncd_traff %>% filter(unit == 'TrafficAcc'),
                             by=c('region' = 'country'))
```

```{r fig.height=6.2}
(map_traff_afr <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="gray90") +
  #ggtitle('2018') + 
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = 'Traffic accident mortality rate') + 
  scale_fill_viridis_c(na.value = 'lightgray') + 
  map.theme + 
  guides(fill = guide_colorbar(title.position = "top")) + 
  theme(legend.position = c(.08, .3),
        legend.title = element_text(size=10)))
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_traff_2030.png", plot = map_traff_afr, height = 10, width = 10, family="Arial", device='png')
```

## Neonatal map: islands 

```{r fig.width=2, fig.height=2}
(s_map_traff_1 <- joined.world.map %>% 
  #filter(region == 'Cape Verde') %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  #summary()
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_traff_2 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_traff_3 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_traff_4 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_traff_5 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```


```{r fig.width=3, fig.height=10}
s_map_traff_plot_grid <- plot_grid(s_map_traff_1, s_map_traff_2, s_map_traff_3, 
                                      s_map_traff_4, s_map_traff_5, 
                             ncol = 1,
                             align = c('h', 'v'))

s_map_traff_plot_grid
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_traff_islands.png", plot = s_map_traff_plot_grid, height = 10, width = 2, family="Arial", device='png')
```


```{r}
(df_hiv_malar <- readxl::read_xlsx('IFs_results_02apr2019.xlsx') %>% 
  filter(unit %in% c('AIDS', 'Malaria')) %>% 
   select(1:5, `2015`, `2030`, `2063`) %>% 
   mutate(africa = 1))
```


# Map of HIV death rate

```{r}
rm(joined.world.map)
joined.world.map <- left_join(x=map.world,
                             y=df_hiv_malar %>% filter(unit == 'Malaria'),
                             by=c('region' = 'country'))
```

```{r fig.height=6.2}
(map_malaria_dr_afr <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="gray90") +
  #ggtitle('2018') + 
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = 'Malaria mortality rate') + 
  scale_fill_viridis_c(na.value = 'lightgray') + 
  map.theme + 
  guides(fill = guide_colorbar(title.position = "top")) + 
  theme(legend.position = c(.08, .3),
        legend.title = element_text(size=10)))
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_malaria_2030.png", plot = map_malaria_dr_afr, height = 10, width = 10, family="Arial", device='png')
```

## Neonatal map: islands 

```{r fig.width=2, fig.height=2}
(s_map_malaria_1 <- joined.world.map %>% 
  #filter(region == 'Cape Verde') %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  #summary()
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_malaria_2 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_malaria_3 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_malaria_4 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_malaria_5 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```


```{r fig.width=3, fig.height=10}
s_map_malaria_plot_grid <- plot_grid(s_map_malaria_1, s_map_malaria_2, s_map_malaria_3, 
                                      s_map_malaria_4, s_map_malaria_5, 
                             ncol = 1,
                             align = c('h', 'v'))

s_map_malaria_plot_grid
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_malaria_islands.png", plot = s_map_malaria_plot_grid, height = 10, width = 2, family="Arial", device='png')
```






# Map of HIV death rate

```{r}
rm(joined.world.map)
joined.world.map <- left_join(x=map.world,
                             y=df_hiv_malar %>% filter(unit == 'AIDS'),
                             by=c('region' = 'country'))
```

```{r fig.height=6.2}
(map_aids_dr_afr <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="gray90") +
  #ggtitle('2018') + 
  coord_map(xlim = c(-30, 60),
            ylim = c(39, -37)) + 
  labs(fill = 'AIDS mortality rate') + 
  scale_fill_viridis_c(na.value = 'lightgray') + 
  map.theme + 
  guides(fill = guide_colorbar(title.position = "top")) + 
  theme(legend.position = c(.08, .3),
        legend.title = element_text(size=10)))
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_aids_2030.png", plot = map_aids_dr_afr, height = 10, width = 10, family="Arial", device='png')
```

## Neonatal map: islands 

```{r fig.width=2, fig.height=2}
(s_map_aids_1 <- joined.world.map %>% 
  #filter(region == 'Cape Verde') %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  #summary()
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Cabo Verde') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(-25.5, -22.2), ylim = c(14.5, 17.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_aids_2 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Comoros') + 
  #labs(caption = 'Using 2014 value if 2015 is NA') + 
  coord_map(xlim = c(42.1, 45.4), ylim = c(-13.4, -10.1)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_aids_3 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Mauritius') + 
  coord_map(xlim = c(56, 59.3), ylim = c(-22.3, -19)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_aids_4 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Sao Tome and Principe') + 
  coord_map(xlim = c(5, 8.3), ylim = c(-.5, 2.8)) + 
  map.theme.small)
```

```{r fig.width=2, fig.height=2}
(s_map_aids_5 <- joined.world.map %>% 
  filter(africa == 1 | 
         region == 'Western Sahara') %>% 
  ggplot(.) +
  geom_polygon(aes(x = long, y = lat, group = group, fill = `2030`), color="white") +
  scale_fill_viridis_c(na.value = 'lightgray') +
  ggtitle('Seychelles') + 
  coord_map(xlim = c(55.2, 55.8), ylim = c(-4.9, -4.4)) + 
  map.theme.small)
```


```{r fig.width=3, fig.height=10}
s_map_aids_plot_grid <- plot_grid(s_map_aids_1, s_map_aids_2, s_map_aids_3, 
                                      s_map_aids_4, s_map_aids_5, 
                             ncol = 1,
                             align = c('h', 'v'))

s_map_aids_plot_grid
```

```{r}
#ggsave("map_test.pdf", plot = l_map, height = 20, width = 8, family="Arial", device=cairo_pdf)
ggsave("map_aids_islands.png", plot = s_map_aids_plot_grid, height = 10, width = 2, family="Arial", device='png')
```


